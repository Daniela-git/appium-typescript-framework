name: emulators
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main repository
        uses: actions/checkout@v3
      - name: Install appium
        run: |
          npm install -g appium
          appium -v
          appium driver install uiautomator2
      - name: Install packages repo
        run: npm install
      - name: list
        run: ls
      - name: Run appium server
        run: |
          cwd=$(pwd)
          pushd "$cwd"
          cd ~
          nohup appium server \
            --port=$APPIUM_TEST_SERVER_PORT \
            --base-path=/wd/hub \
            2>&1 > "$cwd/appium.log" &
          popd
      - name: Run tests
        uses: reactivecircus/android-emulator-runner@v2
        with:
          script: npm run wdio:android
          avd-name: emulator
          sdcard-path-or-size: 1500M
          api-level: 33
          ram-size: 4096M
          heap-size: 1024M
